<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infrasight | рд╡рд┐рджреНрдпрд╛рд▓рдп рд░рд┐рдкреЛрд░реНрдЯ</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Hind+Siliguri:wght@400;600&display=swap');
    body {
      font-family: 'Inter', 'Hind Siliguri', sans-serif;
      background-color: #f8fafc;
    }
    .navbar {
      background-color: #1e3a8a;
    }
    #map {
      height: 350px;
      width: 100%;
      border-radius: 10px;
      margin-top: 10px;
    }
    #video-stream {
      width: 100%;
      max-width: 400px;
      display: none;
      border-radius: 10px;
      margin: auto;
      background: #000;
    }
    #capture-canvas {
      display: none;
    }
  </style>
</head>

<body onload="lucide.createIcons();">

  <!-- ЁЯМР Header -->
  <header class="navbar p-4 text-white shadow-lg">
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
      <div class="logo flex items-center mb-3 md:mb-0">
        <i data-lucide="school" class="w-8 h-8 mr-3 text-yellow-300"></i>
        <h2 class="text-xl font-bold">Infrasight | рд╡рд┐рджреНрдпрд╛рд▓рдп рдЕрд╡рд╕рдВрд░рдЪрдирд╛ рдирд┐рдЧрд░рд╛рдиреА рдкреНрд░рдгрд╛рд▓реА</h2>
      </div>
      <div class="flex items-center space-x-4">
        <select id="langSelect" class="p-2 text-black rounded-md">
          <option value="hi">рд╣рд┐рдиреНрджреА</option>
          <option value="en">English</option>
        </select>
        <nav>
          <ul class="flex space-x-4 md:space-x-6 font-medium">
            <li><a href="index.html" class="hover:text-yellow-300">рдореБрдЦрдкреГрд╖реНрда</a></li>
            <li><a href="status.html" class="hover:text-yellow-300">рд╕реНрдерд┐рддрд┐</a></li>
            <li><a href="report.html" class="text-yellow-300 border-b-2 border-yellow-300">рд░рд┐рдкреЛрд░реНрдЯ</a></li>
            <li><a href="contact.html" class="hover:text-yellow-300">рд╕рдВрдкрд░реНрдХ</a></li>
            <li><a href="team.html" class="hover:text-yellow-300">Team</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <!-- ЁЯУЛ Report Form -->
  <section class="max-w-3xl mx-auto p-6 md:p-8 bg-white my-10 rounded-xl shadow-2xl">
    <h1 id="form-title" class="text-3xl font-extrabold text-indigo-700 mb-2">рд╕реНрдХреВрд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░реЗрдВ</h1>
    <p id="form-desc" class="text-gray-600 mb-6">рдХреГрдкрдпрд╛ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╡рд┐рд╡рд░рдг рднрд░реЗрдВ рддрд╛рдХрд┐ рд╕рд░рдХрд╛рд░ рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХреЗред</p>

    <form id="reportForm" class="space-y-4">
      <div>
        <label id="label-name" for="name" class="block text-sm font-medium text-gray-700 mb-1">рдЖрдкрдХрд╛ рдирд╛рдо:</label>
        <input type="text" id="name" class="w-full p-3 border rounded-lg" placeholder="рдЕрдкрдирд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ" required>
      </div>

      <div>
        <label id="label-school" for="school" class="block text-sm font-medium text-gray-700 mb-1">рд╕реНрдХреВрд▓ рдХрд╛ рдирд╛рдо:</label>
        <input type="text" id="school" class="w-full p-3 border rounded-lg" placeholder="рд╕реНрдХреВрд▓ рдХрд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ" required>
      </div>

      <div>
        <label id="label-details" for="details" class="block text-sm font-medium text-gray-700 mb-1">рд╡рд┐рд╡рд░рдг:</label>
        <textarea id="details" rows="4" class="w-full p-3 border rounded-lg" placeholder="рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг..." required></textarea>
      </div>

      <!-- ЁЯОе Webcam Capture -->
      <div class="pt-4 border-t border-gray-200">
        <label id="label-photo" class="block text-sm font-bold text-gray-700 mb-2">рд▓рд╛рдЗрд╡ рддрд╕реНрд╡реАрд░ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ:</label>

        <div id="initial-webcam-prompt" class="text-center bg-gray-100 p-4 rounded-xl border-2 border-dashed border-gray-300">
          <p class="mb-3 text-gray-700 font-medium">рдХреИрдорд░рд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред</p>
          <button type="button" id="startWebcamBtn" class="px-5 py-2 bg-indigo-600 text-white rounded-full font-bold hover:bg-indigo-700 transition">
            <i data-lucide="video" class="w-5 h-5 mr-2 inline"></i> рдХреИрдорд░рд╛ рд╢реБрд░реВ рдХрд░реЗрдВ
          </button>
        </div>

        <video id="video-stream" autoplay playsinline></video>
        <button type="button" id="capturePhotoBtn" class="hidden mt-3 px-5 py-2 bg-red-600 text-white rounded-full font-bold hover:bg-red-700 transition">
          <i data-lucide="camera" class="w-5 h-5 mr-2 inline"></i> рддрд╕реНрд╡реАрд░ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ
        </button>

        <canvas id="capture-canvas"></canvas>
        <p id="capture-status" class="text-sm text-gray-600 mt-2 hidden"></p>
        <div id="image-preview-status" class="hidden p-3 bg-green-100 rounded-lg border-l-4 border-green-500 text-green-800 font-semibold mt-3">
          рддрд╕реНрд╡реАрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдХреИрдкреНрдЪрд░ рд╣реЛ рдЧрдИред
        </div>
        <input type="hidden" id="captured_image_data" required>
      </div>

      <!-- ЁЯЧ║я╕П Location -->
      <div class="pt-4 border-t border-gray-200">
        <label id="label-location" class="block text-sm font-medium text-gray-700 mb-1">рд╕реНрдерд╛рди рдЬреЛрдбрд╝реЗрдВ (рдорд╛рдирдЪрд┐рддреНрд░ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ):</label>
        <div id="map"></div>
        <div class="mt-2">
          <label class="text-sm text-gray-700">Latitude:</label>
          <input type="text" id="latitude" readonly class="w-full p-2 border rounded bg-gray-50">
          <label class="text-sm text-gray-700 mt-2">Longitude:</label>
          <input type="text" id="longitude" readonly class="w-full p-2 border rounded bg-gray-50">
        </div>
      </div>

      <button type="submit" id="submit-btn" class="w-full py-3 bg-indigo-600 text-white font-bold text-lg rounded-lg shadow-xl hover:bg-indigo-700 transition">
        <i data-lucide="send" class="w-5 h-5 mr-2 inline"></i> рд░рд┐рдкреЛрд░реНрдЯ рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ
      </button>
    </form>
  </section>

  <!-- ЁЯж╢ Footer -->
  <footer class="p-8 text-center bg-gray-800 text-gray-300">
    <p>┬й 2025 Infrasight | Government of Uttar Pradesh | AI & IoT Initiative</p>
  </footer>

  <!-- JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const video = document.getElementById('video-stream');
    const canvas = document.getElementById('capture-canvas');
    const startBtn = document.getElementById('startWebcamBtn');
    const captureBtn = document.getElementById('capturePhotoBtn');
    const captureStatus = document.getElementById('capture-status');
    const imageStatus = document.getElementById('image-preview-status');
    const inputImage = document.getElementById('captured_image_data');
    const langSelect = document.getElementById('langSelect');
    let streamTrack = null;

    async function startWebcam() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        streamTrack = stream.getVideoTracks()[0];
        video.style.display = 'block';
        captureBtn.classList.remove('hidden');
        document.getElementById('initial-webcam-prompt').classList.add('hidden');
        captureStatus.textContent = 'рдХреИрдорд░рд╛ рдЪрд╛рд▓реВ рд╣реИ, рддрд╕реНрд╡реАрд░ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВред';
        captureStatus.classList.remove('hidden');
      } catch {
        alert('рдХреИрдорд░рд╛ рдЕрдиреБрдорддрд┐ рдЕрд╕реНрд╡реАрдХреГрдд рдпрд╛ рдЕрдиреБрдкрд▓рдмреНрдзред');
      }
    }

    function capturePhoto() {
      if (!streamTrack) return;
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').drawImage(video, 0, 0);
      const dataURL = canvas.toDataURL('image/jpeg');
      inputImage.value = dataURL;
      imageStatus.classList.remove('hidden');
      captureStatus.textContent = 'рддрд╕реНрд╡реАрд░ рдХреИрдкреНрдЪрд░ рдХреА рдЧрдИред';
    }

    startBtn.addEventListener('click', startWebcam);
    captureBtn.addEventListener('click', capturePhoto);

    // ЁЯЧ║я╕П Leaflet map
    const map = L.map('map').setView([26.8467, 80.9462], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '┬й OpenStreetMap'
    }).addTo(map);
    let marker;
    map.on('click', e => {
      if (marker) map.removeLayer(marker);
      marker = L.marker(e.latlng).addTo(map);
      document.getElementById('latitude').value = e.latlng.lat.toFixed(5);
      document.getElementById('longitude').value = e.latlng.lng.toFixed(5);
    });

    // ЁЯМР Language switch
    const translations = {
      hi: {
        "form-title": "рд╕реНрдХреВрд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░реЗрдВ",
        "form-desc": "рдХреГрдкрдпрд╛ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╡рд┐рд╡рд░рдг рднрд░реЗрдВ рддрд╛рдХрд┐ рд╕рд░рдХрд╛рд░ рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХреЗред",
        "label-name": "рдЖрдкрдХрд╛ рдирд╛рдо:",
        "label-school": "рд╕реНрдХреВрд▓ рдХрд╛ рдирд╛рдо:",
        "label-details": "рд╡рд┐рд╡рд░рдг:",
        "label-photo": "рд▓рд╛рдЗрд╡ рддрд╕реНрд╡реАрд░ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ:",
        "label-location": "рд╕реНрдерд╛рди рдЬреЛрдбрд╝реЗрдВ (рдорд╛рдирдЪрд┐рддреНрд░ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ):",
        "submit-btn": "рд░рд┐рдкреЛрд░реНрдЯ рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ"
      },
      en: {
        "form-title": "Report School Condition",
        "form-desc": "Please fill in the details below so authorities can review the issue.",
        "label-name": "Your Name:",
        "label-school": "School Name:",
        "label-details": "Description:",
        "label-photo": "Capture Live Photo:",
        "label-location": "Add Location (Click on Map):",
        "submit-btn": "Submit Report"
      }
    };

    langSelect.addEventListener('change', e => {
      const lang = e.target.value;
      for (const id in translations[lang]) {
        document.getElementById(id).textContent = translations[lang][id];
      }
    });
  </script>
</body>
</html>
